# ربات تلگرام کافی نت مهدی

این پروژه یک ربات تلگرام برای مدیریت سفارشات کافی نت است که با پایتون و SQLite3 توسعه داده شده است.

## ویژگی‌ها

- ثبت نام کاربران جدید
- سیستم معرفی دوستان و پاداش
- مدیریت موجودی کاربران
- پنل ادمین برای مدیریت ربات
- نمایش آمار و اطلاعات کاربران
- ثبت و مدیریت سفارشات پرینت و کپی
- محاسبه قیمت پرینت بر اساس نوع و تعداد صفحات
- پشتیبانی از فایل‌های PDF، Word و PowerPoint
- ارسال و دریافت فایل از تلگرام

## نیازمندی‌ها

- Python 3.8+
- python-telegram-bot==20.8
- requests==2.31.0
- python-dotenv==1.0.1
- matplotlib==3.8.4
- numpy==1.26.4
- arabic-reshaper==3.0.0
- python-bidi==0.4.2
- jdatetime==4.1.1
- PyPDF2==3.0.1
- pymupdf==1.23.22
- python-docx==1.1.0
- python-pptx==0.6.23

## نصب و راه‌اندازی

1. کلون کردن مخزن یا کپی پروژه:
```bash
git clone https://github.com/yourusername/coffenet-bot.git
cd coffenet-bot
```

2. ایجاد محیط مجازی و نصب وابستگی‌ها:
```bash
python -m venv venv
venv\Scripts\activate  # در ویندوز
source venv/bin/activate  # در لینوکس/مک
pip install -r requirements.txt
```

3. تنظیم فایل محیطی:
```bash
cp env.example .env
```
سپس فایل `.env` را با اطلاعات خود ویرایش کنید.

4. راه‌اندازی پایگاه داده (اختیاری):
```bash
python setup_db.py --recreate
```
در اولین اجرا، پایگاه داده به صورت خودکار ساخته می‌شود. اگر نیاز به ریست کامل داشتید، از دستور بالا استفاده کنید.

5. اجرای ربات:
```bash
python main.py
```

## ساختار پروژه

- `bot.py`: فایل اصلی ربات تلگرام و منطق پردازش پیام‌ها
- `database.py`: مدیریت پایگاه داده SQLite3 و جداول
- `config.py`: تنظیمات و متغیرهای محیطی
- `main.py`: فایل اصلی برای اجرای ربات
- `show_users.py`: اسکریپت برای نمایش کاربران ثبت شده
- `setup_db.py`: اسکریپت راه‌اندازی و ریست پایگاه داده
- `requirements.txt`: لیست پیش‌نیازهای پروژه
- `env.example`: نمونه فایل تنظیمات محیطی
- `uploads/`: محل ذخیره فایل‌های آپلود شده توسط کاربران

## نمایش کاربران

برای مشاهده لیست کاربران ثبت شده در ربات، می‌توانید از دستور زیر استفاده کنید:

```bash
python show_users.py
```

این دستور اطلاعات کامل کاربران شامل شناسه، نام کاربری، شماره تلفن، موجودی، تعداد دعوت‌ها و تاریخ ثبت نام را نمایش می‌دهد.

## پایگاه داده

اطلاعات کاربران و سفارشات در فایل `coffenet.db` ذخیره می‌شود. این فایل به صورت خودکار در اولین اجرای ربات ایجاد می‌شود و در اجراهای بعدی حفظ می‌شود.

## ساختار جداول پایگاه داده (خلاصه)

### جدول users
- `user_id`: شناسه کاربر (کلید اصلی)
- `phone_number`: شماره تلفن کاربر
- `balance`: موجودی کاربر
- `username`: نام کاربری در تلگرام
- `created_at`: زمان ثبت نام

### جدول referrals
- `id`: شناسه یکتا (کلید اصلی)
- `inviter_user_id`: شناسه کاربر دعوت‌کننده
- `invitee_user_id`: شناسه کاربر دعوت‌شده
- `inviter_cart_amount`: مبلغ پاداش دعوت‌کننده
- `invitee_cart_amount`: مبلغ پاداش دعوت‌شده
- `referral_date`: تاریخ دعوت

### سایر جداول
- `transactions`: تراکنش‌های مالی
- `card_info`: اطلاعات کارت بانکی
- `print_prices`: قیمت‌های پایه پرینت
- `print_price_ranges`: قیمت‌های بازه‌ای پرینت
- `print_orders`: سفارشات پرینت
- `user_addresses`: آدرس‌های کاربران

---

برای سوالات بیشتر یا پشتیبانی، به [پشتیبانی تلگرام](https://t.me/mohamminch) پیام دهید.

