{
  "name": "internetCoffe-Mahdi",
  "nodes": [
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Merge Switcher data').item.json.result }}",
                    "rightValue": "=menu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7841889f-10c0-4102-bcc7-71281ffa5ef3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Menu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5e0653a0-0a62-4190-9383-0882fe4494b5",
                    "leftValue": "={{ $('Merge Switcher data').item.json.result }}",
                    "rightValue": "requesttodb",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Request to db"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "643809d1-962e-4845-9487-984e2305c366",
                    "leftValue": "={{ $('Merge Switcher data').item.json.result }}",
                    "rightValue": "refral",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "refral"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        520,
        -300
      ],
      "id": "494f5f3e-bd69-4558-afd3-eaef866c0a3d",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botUsername = botData[\"bot-username\"] || \"ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø§Ø¹Ø¯Ø§Ø¯ Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù…\nfunction formatNumberWithCommas(number) {\n    return number.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nconst botreferalcreadit = formatNumberWithCommas(botData[\"referal-creadit\"] || \"0\"); // Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¹ØªØ¨Ø§Ø± Ù…Ø¹Ø±ÙÛŒ\nconst userId = $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"callback_query\"]?.message?.chat?.id || \n                  $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"message\"]?.from?.id;\n\nconst inviteMessage = encodeURIComponent(`\\nØ´Ù…Ø§ Ø¨Ù‡ Ø±Ø¨Ø§Øª ${botName} Ø¯Ø¹ÙˆØª Ø´Ø¯ÛŒØ¯! ğŸ¤\\n\\nØ§ÛŒÙ† Ø±Ø¨Ø§Øª Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ù…ÛŒÚ©Ù†Ù‡ Ø¨Ø¯ÙˆÙ† Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ø¨Ù‡ Ú©Ø§ÙÛŒâ€ŒÙ†Øª Ú©Ø§Ø±Ù‡Ø§ØªÙˆÙ† Ø±Ùˆ ØºÛŒØ±Ø­Ø¶ÙˆØ±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯ÛŒØ¯. Ø¨Ø§ Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª ${botreferalcreadit} ØªÙˆÙ…Ø§Ù† Ø§Ø¹ØªØ¨Ø§Ø± Ù‡Ø¯ÛŒÙ‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯!`);\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original;\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"help^\": {\n        message: `ğŸ“Œ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ${botName}\\n\\n[... Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ...]`,\n        buttons: [\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n    },\n    \"serviceslist^\": {\n        message: `ğŸ“Œ Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ø®Ø¯Ù…Ø§Øª ${botName} Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n        buttons: [\n            [{ text: \"Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±ÛŒÙ†Øª ÛŒØ§ Ú©Ù¾ÛŒ\", url: `https://pelicanstudio.ir/coffenetmehdi?user_id=${userId}` }],\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n    },\n    \"userpanel^\": {\n        message: `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${botName} Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n        buttons: [\n            [{ text: `Ù„ÛŒØ³Øª Ø®Ø¯Ù…Ø§Øª ${botName}`, callback_data: \"serviceslist^\" }],\n            [\n                { text: \"ğŸ’ Ø§Ø¹ØªØ¨Ø§Ø± Ø´Ù…Ø§\", callback_data: \"userprofile^\" },\n                { text: \"ğŸ› Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† \", callback_data: \"club^\" }\n            ],\n            [{ text: \"â£ï¸ Ø¯Ø¹ÙˆØª Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù†\", callback_data: \"Invitefriends^\" }],\n            [\n                { text: \"Â» Ø±Ø§Ù‡Ù†Ù…Ø§\", callback_data: \"help^\" },\n                { text: \"Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }\n            ]\n        ]\n    },\n    \"club^\" : {\n        message: \"ğŸ“Œ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù†\\n\\nØ¨Ù‡ Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² ØªØ®ÙÛŒÙâ€ŒÙ‡Ø§ Ùˆ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª ÙˆÛŒÚ˜Ù‡ Ù…Ø§ Ø¨Ù‡Ø±Ù‡â€ŒÙ…Ù†Ø¯ Ø´ÙˆÛŒØ¯.\",\n        buttons: [\n            [{text: \"ğŸ”¥ Ú©Ø¯Ù‡Ø§ÛŒ ØªØ®ÙÛŒÙ\", callback_data: \"disscount_offers^\"},\n                { text: \"ğŸ„ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§\", callback_data: \"special_offers^\" }\n            \n            ],\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n        },\n    \"joinedch^\": {\n        message: `ğŸ“Œ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ${botName} Ù¾ÛŒÙˆØ³ØªÛŒØ¯.`,\n        buttons: [\n            [{ text: \"Â» Ø¯Ø±ÛŒØ§ÙØª Ù…Ù†Ùˆ\", callback_data: \"userpanel^\" }]\n        ]\n    },\n    \"Invitefriends^\": {\n        message: `Ø¨Ù‡ Ø§Ø²Ø§Ø¡ Ø¯Ø¹ÙˆØª Ù‡Ø± Ù†ÙØ± Ø¨Ù‡ ${botName} ØªÙˆØ³Ø· Ø´Ù…Ø§ØŒ ${botreferalcreadit} ØªÙˆÙ…Ø§Ù† Ø§Ø¹ØªØ¨Ø§Ø± Ù‡Ø¯ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø«Ø¨Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯.\\n\\nØ±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¯Ø¹ÙˆØªÂ» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ù¾ÛŒØ§Ù… Ø¯Ø¹ÙˆØª Ø±Ùˆ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†ØªØ§Ù† Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯.`,\n        buttons: [\n            [{ text: \"ğŸ“© Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¯Ø¹ÙˆØª ğŸ“©\", url: `http://t.me/share/url?url=https://t.me/${botUsername}?start=ref${userId}&text=${inviteMessage}` }],\n            [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n        ]\n    },\n};\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡\nif (responses[inputData]) {\n\t// Replace original return with the new API call format\n\treturn {\n\t\turl: \"https://api.telegram.org/bot\" + $('BOT INFO').item.json.TOKEN + \"/editMessageText\",\n\t\tmethod: \"POST\",\n\t\tparameters: {\n\t\t\tmessage_id: $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"callback_query\"]?.message?.message_id || $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"message\"]?.message_id, // updated message id retrieval\n\t\t\tchat_id: userId, // updated to use the new chat id\n\t\t\ttext: responses[inputData].message,\n\t\t\treply_markup: {\n\t\t\t\tinline_keyboard: responses[inputData].buttons\n\t\t\t},\n\t\t\tparse_mode: \"HTML\"\n\t\t}\n\t};\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nreturn {\n\turl: \"https://api.telegram.org/bot\" + $('BOT INFO').item.json.TOKEN + \"/editMessageText\",\n\tmethod: \"POST\",\n\tparameters: {\n\t\tmessage_id: $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"callback_query\"]?.message?.message_id || $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"message\"]?.message_id, // updated message id retrieval\n        chat_id: userId,\n        text: $json.result || inputData,\n\t\tparse_mode: \"HTML\"\n\t}\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        680,
        -700
      ],
      "id": "8b224d33-d557-4032-83e3-d66df061fbae",
      "name": "Make Menu Message"
    },
    {
      "parameters": {
        "method": "={{ $json.method }}",
        "url": "={{ $json.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.parameters }}",
        "options": {}
      },
      "id": "2c9dfb4e-8799-496a-9f5b-b20046a269d8",
      "name": "SEND result Click Menu Layer 1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        900,
        -700
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e6ada1ee-8e0e-468e-91cb-db6c5e541b6b",
              "name": "TOKEN",
              "value": "7794284252:AAFOha2WHHKYIRTW2Q7eqBHEnSKt3krt378",
              "type": "string"
            },
            {
              "id": "c1ff6ad3-78d3-4380-bbda-b31222ba282b",
              "name": "bot-name",
              "value": "Ú©Ø§ÙÛŒ Ù†Øª Ù…Ù‡Ø¯ÛŒ",
              "type": "string"
            },
            {
              "id": "9a2ab0d9-fae7-49c8-b2b4-211192d48a60",
              "name": "support-username",
              "value": "https://t.me/mohamminch",
              "type": "string"
            },
            {
              "id": "b1d6f329-f012-493e-866b-4c6c304ca8cc",
              "name": "admin-username",
              "value": 882730020,
              "type": "number"
            },
            {
              "id": "a70c4893-7f9d-4714-9c23-e04d8e8265cb",
              "name": "ch-username",
              "value": "https://t.me/coffenetmehdi",
              "type": "string"
            },
            {
              "id": "c07f2ac2-9cbf-48fb-a2c4-a15dc63d7291",
              "name": "ch-id",
              "value": "-1002496906719",
              "type": "string"
            },
            {
              "id": "9d6e5a8d-d57e-4695-a961-4ccc60d83381",
              "name": "bot-username",
              "value": "Cafenetmahdi_bot",
              "type": "string"
            },
            {
              "id": "d11f539f-40b1-4e7d-82c1-706d2e5428a5",
              "name": "referal-creadit",
              "value": "2000",
              "type": "string"
            },
            {
              "id": "b844458a-f38a-4b05-86d5-36f586a25e83",
              "name": "bot-creator",
              "value": "mohamminch",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -600,
        20
      ],
      "id": "14595cb3-5ea0-4fd7-b899-ccc1da006dec",
      "name": "BOT INFO"
    },
    {
      "parameters": {
        "jsCode": "const inputData = $('Coffe-Mahdi').item.json.message.text;\n\nconst predefinedValues = [\"/help\", \"/settings\"];\nlet result = \"undefined\";  // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶\n\nif (inputData.startsWith(\"/start\")) {\n    if (inputData.includes(\"ref\")) {\n        result = \"refral\"; // Ø§Ú¯Ø± Ø´Ø§Ù…Ù„ ref Ø¨Ø§Ø´Ø¯\n    } else {\n        result = \"start-bot\"; // Ø§Ú¯Ø± ÙÙ‚Ø· /start Ø¨Ø§Ø´Ø¯\n    }\n} else if (predefinedValues.includes(inputData)) {\n    result = inputData.slice(1).split(\" \")[0] + \"-bot\"; // Ø³Ø§ÛŒØ± Ù…Ù‚Ø§Ø¯ÛŒØ± ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡\n}\n\nreturn [{\n  result: result,\n  original: inputData\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        200,
        260
      ],
      "id": "a8828096-fa7a-4c48-9561-b25048a61524",
      "name": "Merge Switcher text"
    },
    {
      "parameters": {
        "jsCode": "// ØªØ¹Ø±ÛŒÙ Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§\nconst firstList = [\"help^\", \"userpanel^\", \"serviceslist^\",\"requestslist^\",\"joinedch^\",\"Invitefriends^\",\"club^\"];\nconst secondList = [\"userprofile^\"]; \nconst refralList = [\"joinedch^\"];  // Ù„ÛŒØ³Øª Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ÛŒ refral\n\n// Ø¯Ø§Ø¯Ù‡ ÙˆØ±ÙˆØ¯ÛŒ\nconst inputData = $('Coffe-Mahdi').item.json.callback_query.data;\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯\nlet result = \"\";\nif (firstList.includes(inputData)) {\n  result = \"menu\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª Ø§ÙˆÙ„ Ø¨Ø§Ø´Ø¯\n} else if (secondList.includes(inputData)) {\n  result = \"requesttodb\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª Ø¯ÙˆÙ… Ø¨Ø§Ø´Ø¯\n} else if (refralList.some(item => inputData.startsWith(item))) {\n  result = \"refral\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ù„ÛŒØ³Øª refral Ø¨Ø§Ø´Ø¯\n} else {\n  result = \"Ù†ÛŒØ³Øª\";  // Ø§Ú¯Ø± ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø± Ù‡ÛŒÚ† Ú©Ø¯Ø§Ù… Ø§Ø² Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§ Ù†Ø¨Ø§Ø´Ø¯\n}\n\nreturn [{\n  result: result,\n  original: inputData\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        -300
      ],
      "id": "99043213-02ae-4769-b57a-3f7a3c6a0825",
      "name": "Merge Switcher data"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "=start-bot",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "start"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4cd6c267-7f74-4a2d-a679-b0c9f1c46de9",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "refral",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "refral"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f981e64a-20fc-4443-819a-ef78049a5e86",
                    "leftValue": "={{ $json.result }}",
                    "rightValue": "=undefined",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "undefined"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        380,
        260
      ],
      "id": "00dce254-78a7-4707-bc41-820530782c75",
      "name": "Switch1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT EXISTS (\n    SELECT \"true\"\n    FROM users \n    WHERE user_id = {{ $('Coffe-Mahdi').item.json.message.from.id }}\n) AS user_exists;",
        "options": {}
      },
      "id": "947b48e9-a644-4b00-a556-06aa200edae2",
      "name": "Check user_exists",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1260,
        500
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f9f3477f-0c5e-4945-9bdb-a8f12de93d6c",
              "leftValue": "={{ $('Check user_exists').item.json.user_exists }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d6398fae-ad89-4855-aa99-656f461775db",
      "name": "T OR F",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1460,
        500
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO users (user_id, phone_number, balance, username, created_at )\nVALUES ({{ $('SIMORGH').item.json.message.from.id }}, '', 0, '{{ $('SIMORGH').item.json.message.from.username || \"\" }}',{{ $('SIMORGH').item.json.message.date }})\nON DUPLICATE KEY UPDATE user_id = user_id;\n",
        "options": {}
      },
      "id": "f0cf84b8-ac14-48cd-b25c-aa7b18a9c81f",
      "name": "Set User",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1540,
        320
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('BOT INFO').item.json['admin-username'] }}",
        "text": "=ğŸ“¢ #Ú©Ø§Ø±Ø¨Ø±_Ø¬Ø¯ÛŒØ¯ Ø±Ø¨Ø§Øª Ø´Ù…Ø§ Ø±Ø§ Ø§Ø³ØªØ§Ø±Øª Ú©Ø±Ø¯!\n\nğŸ”¹ **Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±**: {{ $('Coffe-Mahdi').item.json.message.from.first_name }}\nğŸ”¹ **Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±**: [{{ $('Coffe-Mahdi').item.json.message.from.id }}](https://t.me/{{ $('Coffe-Mahdi').item.json.message.from.username || \"\" }})\nğŸ”¹ **Ø²Ù…Ø§Ù† Ø§Ø³ØªØ§Ø±Øª**: `{{ new Date().toLocaleDateString('fa-IR').replace(/(\\d{4})\\/(\\d{2})\\/(\\d{2})/, (match, p1, p2, p3) => `${parseInt(p1)-622}/${p2}/${p3}`) }}`",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "8fb2e03d-f992-4147-a9f7-d2e6e634ed93",
      "name": "New User Notify Admin",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1720,
        320
      ],
      "webhookId": "d6bc17b4-95a3-43b7-a95d-9d37692b96ad",
      "credentials": {
        "telegramApi": {
          "id": "yluO7J4XFRkO6HN9",
          "name": "COFFE-NET-BOT"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json;\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\";\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\";\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original;\n\n// Ø³Ø§Ø®Øª Ú©ÙˆØ¦Ø±ÛŒ SQL Ø¨Ø±Ø§ÛŒ userprofile^\nif (inputData === \"userprofile^\") {\n    const userId = $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"callback_query\"]?.message?.chat?.id || \n                  $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"message\"]?.from?.id;\n\n    if (userId && !isNaN(userId)) {\n        // Removed table creation query; using only SELECT query.\n        const combinedQuery = `\nSELECT \n  (SELECT balance FROM users WHERE user_id = ${userId}) AS balance,\n  (SELECT COUNT(*) FROM referrals WHERE inviter_user_id = ${userId}) AS referralCount,\n  (SELECT COALESCE(SUM(inviter_cart_amount), 0) FROM referrals WHERE inviter_user_id = ${userId}) AS totalInviterCart;\n        `;\n        return {\n            json: {\n                query: combinedQuery\n            }\n        };\n    } else {\n        return {\n            json: {\n                error: \"Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª\",\n                status: \"error\"\n            }\n        };\n    }\n} else {\n    return {\n        json: {\n            result: $json.result || \"Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯\",\n            original: inputData\n        }\n    };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        740,
        -520
      ],
      "id": "493f97d9-e444-46a0-b5e1-cea0ec23987e",
      "name": "Make query"
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original;\n\n// Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±\nconst rawUserId = $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"callback_query\"]?.message?.chat?.username ||\n                  $item(\"0\").$node[\"Coffe-Mahdi\"].json[\"message\"]?.from?.username;\nconst userId = rawUserId !== \"undifinded\" ? rawUserId : \"\";\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù†ÙˆØ¯ Request-to-db\nconst userBalance = $item(\"0\").$node[\"Request-to-db\"].json.balance || \"0\";\n// New extraction for additional fields with default empty string if undefined\nconst referralCount = $item(\"0\").$node[\"Request-to-db\"].json.referralCount || \"\";\nconst totalInviterCart = $item(\"0\").$node[\"Request-to-db\"].json.totalInviterCart || \"\";\n\n// Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯ÛŒ\nconst formattedBalance = userBalance.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\nconst formattotalInviterCart = totalInviterCart.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"userprofile^\": {\n        // If userId exists, prepend @, otherwise leave blank.\n        message: `Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§:\\n\\nÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: ${userId ? \"@\" + userId : \"\"}\\nÙ…ÙˆØ¬ÙˆØ¯ÛŒ: ${formattedBalance} ØªÙˆÙ…Ø§Ù†\\n\\nØªØ¹Ø¯Ø§Ø¯ Ø¯Ø¹ÙˆØªâ€ŒÙ‡Ø§: ${referralCount}\\nÙ…Ø¨Ù„Øº Ù‡Ø¯ÛŒÙ‡ Ø¯Ø±ÛŒØ§ÙØªÛŒ: ${formattotalInviterCart}`,\n        buttons: [\n           \n                 [{ text: \"Â» Ø§Ø¹ØªØ¨Ø§Ø± Ù‡Ø¯ÛŒÙ‡\", callback_data: \"Invitefriends^\" },\n                { text: \"Â» Ø§ÙØ²Ø§ÛŒØ´ Ù…ÙˆØ¬ÙˆØ¯ÛŒ\", callback_data: \"increasebalance^\" }],\n                [{ text: \"Â» Ø¨Ø§Ø²Ú¯Ø´Øª\", callback_data: \"userpanel^\" }]\n            \n        ]\n    }\n    // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø±Ø§ Ø¨Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯\n};\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡\nif (responses[inputData]) {\n    return {\n        json: {\n            message: responses[inputData].message,\n            reply_markup: {\n                inline_keyboard: responses[inputData].buttons // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ ØªØ§ Ø²ÛŒØ± Ù‡Ù… Ø¨Ø§Ø´Ù†Ø¯\n            },\n            parse_mode: \"HTML\"\n        }\n    };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nreturn {\n    json: {\n        result: $json.result,\n        original: inputData\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1080,
        -520
      ],
      "id": "81d1043b-37d1-413d-bedd-1d1d2098920b",
      "name": "Make Menu Message2"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "{{ $json.query }}",
        "options": {}
      },
      "id": "cfd64dbb-a168-40ec-a4f9-bd13c063c4b5",
      "name": "Request-to-db",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        900,
        -520
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('BOT INFO').item.json.TOKEN }}/editMessageText",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "chat_id",
              "value": "={{ $('Coffe-Mahdi').item.json.callback_query.message.chat.id }}"
            },
            {
              "name": "text",
              "value": "={{ $json.message }}"
            },
            {
              "name": "reply_markup",
              "value": "={{ $json.reply_markup }}"
            },
            {
              "name": "message_id",
              "value": "={{ $('Coffe-Mahdi').item.json.callback_query.message.message_id }}"
            },
            {
              "name": "parse_mode",
              "value": "={{ $json.parse_mode }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f89fc478-79a7-43a4-928a-ff5ff64d8b96",
      "name": "SEND result Click Menu Layer 2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1280,
        -520
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "033e58ab-9bff-4372-b994-98c95e783a10",
              "leftValue": "={{ $('Coffe-Mahdi').item.json.callback_query }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "df38376a-48a2-412b-aa30-8a87b1aa27f0",
      "name": "Check_Message_type",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        40,
        40
      ]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "member",
        "chatId": "={{ $('BOT INFO').item.json['ch-id'] }}",
        "userId": "={{ ($('Coffe-Mahdi').item.json.callback_query?.message?.chat?.id != null && $('Coffe-Mahdi').item.json.callback_query?.message?.chat?.id !== '') ? $('Coffe-Mahdi').item.json.callback_query.message.chat.id : ($('Coffe-Mahdi').item.json.message?.from?.id != null && $('Coffe-Mahdi').item.json.message?.from?.id !== '') ? $('Coffe-Mahdi').item.json.message.from.id : ($('Coffe-Mahdi').item.json.my_chat_member?.from?.id != null && $('Coffe-Mahdi').item.json.my_chat_member.from.id !== '') ? $('Coffe-Mahdi').item.json.my_chat_member.from.id : '' }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -400,
        20
      ],
      "id": "a95a574b-497a-4f10-ac16-e2f10c5bfa0c",
      "name": "Check Channel User",
      "webhookId": "95fca364-1086-47d5-a582-f763dcad3cb2",
      "credentials": {
        "telegramApi": {
          "id": "yluO7J4XFRkO6HN9",
          "name": "COFFE-NET-BOT"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "093df3c4-a8f5-45c8-9dc5-d448c3aaec76",
              "leftValue": "={{ $('Check Channel User').item.json.result.status }}",
              "rightValue": "member",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -240,
        20
      ],
      "id": "9a88e977-0fbc-4c53-890f-250cd1766097",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8cbf4405-ec74-43e5-bc14-ce352eea6fcb",
              "leftValue": "={{ $json.result.status }}",
              "rightValue": "creator",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -160,
        -160
      ],
      "id": "f6819c67-5158-4cb1-be3b-3cb3e2b8ea61",
      "name": "Check Creator"
    },
    {
      "parameters": {
        "chatId": "={{ $('If').item.json.result.user.id }}",
        "text": "={{ $('Coffe-Mahdi').item.json.message?.text?.includes('ref') ? 'Ø³Ù„Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø¹ØªØ¨Ø§Ø± Ù‡Ø¯ÛŒÙ‡ Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø²ÛŒØ± Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ \\n\\nÙ¾Ø³ Ø§Ø² Ø¹Ø¶Ùˆ Ø´Ø¯Ù† Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ \"Ø¹Ø¶Ùˆ Ø´Ø¯Ù…\" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯!' : $('Coffe-Mahdi').item.json.message?.text === undefined ? 'Ù‡Ù†ÙˆØ² Ø¹Ø¶Ùˆ Ù†Ø´Ø¯ÛŒØ¯! Ø§ÙˆÙ„ Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ø±ÙˆÛŒ \"Ø¹Ø¶Ùˆ Ø´Ø¯Ù…\" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯!' : 'Ø³Ù„Ø§Ù… Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÙØ¹Ø§Ù„ÛŒØª Ù†ÛŒØ§Ø² Ù‡Ø³Øª Ú©Ù‡ Ø¯Ø§Ø®Ù„ Ú©Ø§Ù†Ø§Ù„ Ø²ÛŒØ± Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯ \\n\\nÙ¾Ø³ Ø§Ø² Ø¹Ø¶Ùˆ Ø´Ø¯Ù† Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ \"Ø¹Ø¶Ùˆ Ø´Ø¯Ù…\" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯!' }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "=Ú©Ø§Ù†Ø§Ù„ {{ $('BOT INFO').item.json['bot-name'] }}",
                    "additionalFields": {
                      "url": "={{ $('BOT INFO').item.json['ch-username'] }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "Ø¹Ø¶Ùˆ Ø´Ø¯Ù…!",
                    "additionalFields": {
                      "callback_data": "={{ \n  $('Coffe-Mahdi').item.json.message?.text?.split(\"ref\")[1] \n  ? `joinedch^${$('Coffe-Mahdi').item.json.message.text.split(\"ref\")[1]}` \n  : $('Coffe-Mahdi').item.json.message?.text ? 'joinedch^' : $('Coffe-Mahdi').item.json.callback_query?.data || 'joinedch^' \n}}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -100,
        -340
      ],
      "id": "7ab508aa-f09f-4314-aaae-0b03262813fb",
      "name": "LINK JOIN",
      "webhookId": "b42bca7e-c028-482a-9fd8-fea2f9a8d3e8",
      "credentials": {
        "telegramApi": {
          "id": "yluO7J4XFRkO6HN9",
          "name": "COFFE-NET-BOT"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT EXISTS (\n    SELECT \"true\"\n    FROM users \n    WHERE user_id = {{ $('Coffe-Mahdi').item.json.callback_query.message.chat.id }}\n) AS user_exists;",
        "options": {}
      },
      "id": "869b50c9-8781-4e23-961d-f27315b1f4fc",
      "name": "Check user_exists1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1080,
        -700
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "f9f3477f-0c5e-4945-9bdb-a8f12de93d6c",
              "leftValue": "={{ $('Check user_exists1').item.json.user_exists }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "378fe5b5-7770-4cf2-a219-938a10bd115b",
      "name": "T OR F1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1260,
        -700
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO users (user_id, phone_number, balance, username, created_at )\nVALUES ({{ $('SIMORGH').item.json.callback_query.message.chat.id }}, '', 0, '{{ $('SIMORGH').item.json.callback_query.message.chat.username || \"\" }}',{{ $('SIMORGH').item.json.callback_query.message.date }})\nON DUPLICATE KEY UPDATE user_id = user_id;\n",
        "options": {}
      },
      "id": "49b421d0-2d98-42d0-95bc-7b7fd152b328",
      "name": "Set User1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1340,
        -880
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('BOT INFO').item.json['admin-username'] }}",
        "text": "=ğŸ“¢ #Ú©Ø§Ø±Ø¨Ø±_Ø¬Ø¯ÛŒØ¯ Ø±Ø¨Ø§Øª Ø´Ù…Ø§ Ø±Ø§ Ø§Ø³ØªØ§Ø±Øª Ú©Ø±Ø¯!\n\nğŸ”¹ **Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±**: {{$('Coffe-Mahdi').item.json.callback_query.message.chat.first_name  }}\nğŸ”¹ **Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±**: [{{ $('Coffe-Mahdi').item.json.callback_query.message.chat.id }}](https://t.me/{{ $('Coffe-Mahdi').item.json.callback_query.message.chat.username }} || \"\" }})\nğŸ”¹ **Ø²Ù…Ø§Ù† Ø§Ø³ØªØ§Ø±Øª**: `{{ new Date().toLocaleDateString('fa-IR').replace(/(\\d{4})\\/(\\d{2})\\/(\\d{2})/, (match, p1, p2, p3) => `${parseInt(p1)-622}/${p2}/${p3}`) }}`",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "f8e5495c-043e-4570-b5b3-228036232a5d",
      "name": "New User Notify Admin1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1520,
        -880
      ],
      "webhookId": "4c00a93b-d799-4b71-87e2-da7393b24c92",
      "credentials": {
        "telegramApi": {
          "id": "yluO7J4XFRkO6HN9",
          "name": "COFFE-NET-BOT"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\nconst botadmin = botData[\"admin-username\"] || \"Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ†\nconst bottoken = botData[\"TOKEN\"] || \"ØªÙˆÚ©Ù† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ø¨Ø§Øª\nconst botcreator = botData[\"bot-creator\"] || \"Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø§Øª\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher text').item.json.original;\nconst userData = $('Coffe-Mahdi').item.json.message.from; // ÙØ±Ø¶ Ú©Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø² Ù†ÙˆØ¯ User Info Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯\nconst isAdmin = userData[\"id\"] === botadmin; // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª ÛŒØ§ Ù†Ù‡\n\n// ØªØ¹Ø±ÛŒÙ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù‡Ø± Ù…Ù‚Ø¯Ø§Ø± original\nconst responses = {\n    \"/start\": {\n        message: `Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ ${botName} Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :`,\n        buttons: [\n            [{ text: `Ù„ÛŒØ³Øª Ø®Ø¯Ù…Ø§Øª ${botName}`, callback_data: \"serviceslist^\" }],\n            [\n                { text: \"ğŸ’ Ø§Ø¹ØªØ¨Ø§Ø± Ø´Ù…Ø§\", callback_data: \"userprofile^\" },\n                { text: \"ğŸ› Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† \", callback_data: \"club^\" }\n            ],\n            [{ text: `â£ï¸ Ø¯Ø¹ÙˆØª Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù†`, callback_data: \"Invitefriends^\" }],\n            [\n                { text: \"Â» Ø±Ø§Ù‡Ù†Ù…Ø§\", callback_data: \"help^\" },\n                { text: \"Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\", url: `${botsupport}` }\n            ]\n        ]\n    },\n    \"admin_panel\": {\n        message: `Ø§Ø¯Ù…ÛŒÙ† Ú¯Ø±Ø§Ù…ÛŒ\\nØ¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª ${botName} Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ :`,\n        buttons: [\n            [{ text: \"Â» Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†\", callback_data: \"manageusers^\" }],\n            [{ text: \"Â» Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§\", callback_data: \"reports^\" }],\n            [{ text: \"Â» ØªÙ†Ø¸ÛŒÙ…Ø§Øª\", callback_data: \"settings^\" }]\n        ]\n    }\n};\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®ØªÙ† Ø¯Ø³ØªÙˆØ± curl\nfunction createCurlCommand(chatId, message, replyMarkup) {\n    return {\n        url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n        method: \"POST\",\n        parameters: {\n            chat_id: chatId,\n            text: message,\n            reply_markup: replyMarkup,\n            parse_mode: \"HTML\"\n        }\n    };\n}\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®ØªÙ† Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶\nfunction createDefaultResponse(inputData, userData) {\n    const message = \"âš ï¸ Ú¯Ø²Ø§Ø±Ø´ Ø®Ø·Ø§: ÙˆØ±ÙˆØ¯ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.\\n\\n\" +\n                    \"ğŸ” Ù…Ù‚Ø¯Ø§Ø± ÙˆØ±ÙˆØ¯ÛŒ: <code>\" + inputData + \"</code>\\n\\n\" +\n                    \"ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:\\n\" +\n                    \"ID: \" + userData.id + \"\\n\" +\n                    \"Ù†Ø§Ù…: \" + (userData.first_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\") + \"\\n\" +\n                    \"Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: \" + (userData.last_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\") + \"\\n\" +\n                    \"ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @\" + (userData.username || \"Ù†Ø§Ù…Ø´Ø®Øµ\") + \"\\n\\n\" +\n                    \"ğŸ“Œ Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.\\n\\n\" +\n                    \"Â©ï¸ 2023 \" + botName;\n    const buttons = [\n        [{ text: \"Â» ØªÙ…Ø§Ø³ Ø¨Ø§ Ø³Ø§Ø²Ù†Ø¯Ù‡\", url: `https://t.me/${botcreator}` }]\n    ];\n    return {\n        message,\n        buttons,\n        curl: createCurlCommand(botadmin, message, { inline_keyboard: buttons })\n    };\n}\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡\nif (responses[inputData]) {\n    const response = isAdmin && inputData === \"/start\" ? responses[\"admin_panel\"] : responses[inputData];\n    const result = {\n        json: {\n            message: response.message,\n            reply_markup: {\n                inline_keyboard: response.buttons // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ ØªØ§ Ø²ÛŒØ± Ù‡Ù… Ø¨Ø§Ø´Ù†Ø¯\n            },\n            parse_mode: \"HTML\"\n        }\n    };\n\n    // Ø³Ø§Ø®ØªÙ† Ø¯Ø³ØªÙˆØ± curl Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ /start\n    if (inputData === \"/start\") {\n        result.json.user = {\n            url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n            method: \"POST\",\n            parameters: {\n                chat_id: userData[\"id\"],\n                text: response.message,\n                reply_markup: result.json.reply_markup,\n                parse_mode: \"HTML\"\n            }\n        };\n\n        const adminMessage = `ÛŒÚ© Ù†ÙØ± Ø±Ø¨Ø§Øª Ø±Ø§ Ø§Ø³ØªØ§Ø±Øª Ú©Ø±Ø¯Ù‡\\n\\n` +\n                             `Ù†Ø§Ù…: ${userData.first_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\"}\\n` +\n                             `Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: ${userData.last_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\"}\\n` +\n                             `ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @${userData.username || \"Ù†Ø§Ù…Ø´Ø®Øµ\"}`;\n        result.json.admin = {\n            url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n            method: \"POST\",\n            parameters: {\n                chat_id: botadmin,\n                text: adminMessage,\n                parse_mode: \"HTML\"\n            }\n        };\n    }\n\n    return result;\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nconst defaultResponse = createDefaultResponse(inputData, userData);\n\n// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±\nconst userErrorMessage = {\n    url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n    method: \"POST\",\n    parameters: {\n        chat_id: userData[\"id\"],\n        text: \"Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù… Ú†ÛŒ Ú¯ÙØªÛŒ! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.\",\n        parse_mode: \"HTML\"\n    }\n};\n\nreturn {\n    json: {\n        message: defaultResponse.message,\n        reply_markup: {\n            inline_keyboard: defaultResponse.buttons\n        },\n        parse_mode: \"HTML\",\n        curl: defaultResponse.curl,\n        userError: userErrorMessage\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        660,
        500
      ],
      "id": "dcbd95af-4601-477e-8d2e-561845edfa7c",
      "name": "Make Menu Message3"
    },
    {
      "parameters": {
        "method": "={{ $json.user.method }}",
        "url": "={{ $json.user.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.user.parameters }}",
        "options": {}
      },
      "id": "ead5b15c-b585-4066-bac7-096e75ceff13",
      "name": "SEND result Click Menu TO USER",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        840,
        500
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message3').item.json.admin.method }}",
        "url": "={{ $('Make Menu Message3').item.json.admin.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message3').item.json.admin.parameters }}",
        "options": {}
      },
      "id": "59b21a29-f5d7-4528-88d5-ce2ef76a6400",
      "name": "SEND result Click Menu TO ADMIN",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1060,
        500
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\nconst botadmin = botData[\"admin-username\"] || \"Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ†\nconst bottoken = botData[\"TOKEN\"] || \"ØªÙˆÚ©Ù† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ø¨Ø§Øª\nconst botcreator = botData[\"bot-creator\"] || \"Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø§Øª\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher text').item.json.original;\nconst userData = $('Coffe-Mahdi').item.json.message.from; // ÙØ±Ø¶ Ú©Ù†ÛŒØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø² Ù†ÙˆØ¯ User Info Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯\nconst isAdmin = userData[\"id\"] === botadmin; // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª ÛŒØ§ Ù†Ù‡\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®ØªÙ† Ø¯Ø³ØªÙˆØ± curl\nfunction createCurlCommand(chatId, message, replyMarkup) {\n    return {\n        url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n        method: \"POST\",\n        parameters: {\n            chat_id: chatId,\n            text: message,\n            reply_markup: replyMarkup,\n            parse_mode: \"HTML\"\n        }\n    };\n}\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®ØªÙ† Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶\nfunction createDefaultResponse(inputData, userData) {\n    const message = \"âš ï¸ Ú¯Ø²Ø§Ø±Ø´ Ø®Ø·Ø§: ÙˆØ±ÙˆØ¯ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.\\n\\n\" +\n                    \"ğŸ” Ù…Ù‚Ø¯Ø§Ø± ÙˆØ±ÙˆØ¯ÛŒ: <code>\" + inputData + \"</code>\\n\\n\" +\n                    \"ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±:\\n\" +\n                    \"ID: \" + userData.id + \"\\n\" +\n                    \"Ù†Ø§Ù…: \" + (userData.first_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\") + \"\\n\" +\n                    \"Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ: \" + (userData.last_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\") + \"\\n\" +\n                    \"ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @\" + (userData.username || \"Ù†Ø§Ù…Ø´Ø®Øµ\") + \"\\n\\n\" +\n                    \"ğŸ“Œ Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.\\n\\n\" +\n                    \"Â©ï¸ 2023 \" + botName;\n    const buttons = [\n        [{ text: \"Â» ØªÙ…Ø§Ø³ Ø¨Ø§ Ø³Ø§Ø²Ù†Ø¯Ù‡\", url: `https://t.me/${botcreator}` }]\n    ];\n    return {\n        message,\n        buttons,\n        curl: createCurlCommand(botadmin, message, { inline_keyboard: buttons })\n    };\n}\n\n// Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¨Ø±Ø§Ø¨Ø± undefined Ø§Ø³Øª ÛŒØ§ Ù†Ù‡\nif (inputData === undefined) {\n    const defaultResponse = createDefaultResponse(inputData, userData);\n\n    // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±\n    const userErrorMessage = {\n        url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n        method: \"POST\",\n        parameters: {\n            chat_id: userData[\"id\"],\n            text: \"Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù… Ú†ÛŒ Ú¯ÙØªÛŒ! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.\",\n            parse_mode: \"HTML\"\n        }\n    };\n\n    return {\n        json: {\n            message: defaultResponse.message,\n            reply_markup: {\n                inline_keyboard: defaultResponse.buttons\n            },\n            parse_mode: \"HTML\",\n            curl: defaultResponse.curl,\n            userError: userErrorMessage\n        }\n    };\n}\n\n// Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…Ù‚Ø¯Ø§Ø± original Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¨ÙˆØ¯\nconst defaultResponse = createDefaultResponse(inputData, userData);\n\n// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±\nconst userErrorMessage = {\n    url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n    method: \"POST\",\n    parameters: {\n        chat_id: userData[\"id\"],\n        text: \"Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù… Ú†ÛŒ Ú¯ÙØªÛŒ! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.\",\n        parse_mode: \"HTML\"\n    }\n};\n\nreturn {\n    json: {\n        message: defaultResponse.message,\n        reply_markup: {\n            inline_keyboard: defaultResponse.buttons\n        },\n        parse_mode: \"HTML\",\n        curl: defaultResponse.curl,\n        userError: userErrorMessage\n    }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        600,
        860
      ],
      "id": "4230a6e7-d2df-46fd-9d87-b97071ae705a",
      "name": "Make Menu Message4"
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message4').item.json.userError.method }}",
        "url": "={{ $('Make Menu Message4').item.json.userError.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message4').item.json.userError.parameters }}",
        "options": {}
      },
      "id": "ae6b745b-ab9a-44fe-b3e7-291d1761b9a8",
      "name": "SEND result Click Menu TO USER1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        800,
        860
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message4').item.json.curl.method }}",
        "url": "={{ $('Make Menu Message4').item.json.curl.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message4').item.json.curl.parameters }}",
        "options": {}
      },
      "id": "5ffb6181-bd93-4be2-8c34-e056b604bbb9",
      "name": "SEND result Click Menu TO ADMIN1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1020,
        860
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\nconst botadmin = botData[\"admin-username\"] || \"Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ†\nconst bottoken = botData[\"TOKEN\"] || \"ØªÙˆÚ©Ù† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ø¨Ø§Øª\nconst botcreator = botData[\"bot-creator\"] || \"Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø§Øª\nconst botreferalcreadit = parseInt(botData[\"referal-creadit\"] || \"0\", 10); // Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¹ØªØ¨Ø§Ø± Ø±ÙØ±Ø§Ù„ Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¹Ø¯Ø¯\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher text').item.json.original; // ÙˆØ±ÙˆØ¯ÛŒ Ø§ØµÙ„ÛŒ Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst userData = $('Coffe-Mahdi').item.json.message.from; // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø² Ù†ÙˆØ¯ User Info Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯\n\n// Ù†ÙˆØ¯ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø¨Ø±\nconst userExists = $('Check User Existence').item.json.user_exists; // Ø®Ø±ÙˆØ¬ÛŒ Ù†ÙˆØ¯ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø¨Ø±\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øªâ€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø¨Ù„Øº Ø±ÙØ±Ø§Ù„ Ø¨Ù‡ Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù…\nfunction formatNumberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\n// Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ\nlet log = {\n    inputData: inputData,\n};\n\n// Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒ /start ref<referral_id>\nif (inputData && inputData.startsWith(\"/start ref\")) {\n    const refCodeMatch = inputData.match(/\\/start ref(\\d+)/);\n    if (refCodeMatch) {\n        const referrerId = refCodeMatch[1];\n\n        // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø®ÙˆØ¯Ø´ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡\n        if (String(userData[\"id\"]) === String(referrerId)) {\n            const selfReferralMessage = \"Ø´Ù…Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø®ÙˆØ¯ØªØ§Ù† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø¹ÙˆØª Ú©Ù†ÛŒØ¯.\";\n\n            const result = {\n                json: {}\n            };\n            result.json = {\n                url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n                method: \"POST\",\n                parameters: {\n                    chat_id: userData[\"id\"],\n                    text: selfReferralMessage,\n                    parse_mode: \"HTML\",\n                    reply_markup: {\n                        inline_keyboard: [[{ text: \"Ø¯Ø¹ÙˆØª Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù†\", callback_data: \"Invitefriends^\" }]]\n                    }\n                }\n            };\n\n            return [{\n                result: \"self_referral\",\n                userMessage: result.json,\n                log: log\n            }];\n        }\n\n        // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø¯ÛŒÚ¯Ø±\n        let referralMessage = \"\";\n        let referrerMessage = null;\n        let adminMessage = \"\";\n\n        if (userExists === 1) {\n            referralMessage = \"Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¹Ø¶Ùˆ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯. ğŸ˜‰\";\n            referrerMessage = null; // Ø¨Ø±Ø§ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯\n            adminMessage = \"\"; // Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯\n        } else {\n            // Ù…Ù†Ø·Ù‚ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ú©Ù‡ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø¯ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø³Øª\n            const totalReferralAmount = botreferalcreadit * 2; // Ø¬Ù…Ø¹ Ù…Ø¨Ù„Øº Ø±ÙØ±Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù\n            referralMessage = `ğŸ‰ Ù…Ø¨Ù„Øº ${formatNumberWithCommas(botreferalcreadit)} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! ğŸ’°`;\n            referrerMessage = `ğŸ‰ ÙØ±Ø¯ÛŒ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø´Ù…Ø§ ÙˆØ§Ø±Ø¯ Ø±Ø¨Ø§Øª Ø´Ø¯ Ùˆ Ù…Ø¨Ù„Øº ${formatNumberWithCommas(botreferalcreadit)} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! ğŸ’°`;\n            adminMessage = `ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ | ÛŒÚ© ÛŒÙˆØ²Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù¾ÛŒÙˆØ³Øª!\\n\\n- Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡: ${userData.first_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\"} ${userData.last_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\"} (@${userData.username || \"Ù†Ø§Ù…Ø´Ø®Øµ\"})\\n- Ù…Ø¨Ù„Øº Ø±ÙØ±Ø§Ù„: ${formatNumberWithCommas(totalReferralAmount)} ØªÙˆÙ…Ø§Ù†\\n- Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡: ${referrerId}\\n- Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡: ${userData[\"id\"]}`;\n        }\n\n        const result = {\n            json: {\n                user: {\n                    url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n                    method: \"POST\",\n                    parameters: {\n                        chat_id: userData[\"id\"],\n                        text: referralMessage,\n                        parse_mode: \"HTML\"\n                    }\n                }\n            }\n        };\n\n        if (referrerMessage) {\n            result.json.referrer = {\n                url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n                method: \"POST\",\n                parameters: {\n                    chat_id: referrerId,\n                    text: referrerMessage,\n                    parse_mode: \"HTML\"\n                }\n            };\n        }\n\n        result.json.admin = {\n            url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n            method: \"POST\",\n            parameters: {\n                chat_id: botadmin,\n                text: adminMessage,\n                parse_mode: \"HTML\"\n            }\n        };\n\n        log[\"result\"] = result;  // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ\n\n        return [{\n            result: userExists === 1 ? \"user_exists\" : \"new_referral\",\n            original: inputData,\n            userMessage: result.json.user,\n            referrerMessage: referrerMessage ? result.json.referrer : null,\n            adminMessage: result.json.admin,\n            log: log\n        }];\n    } else {\n        log[\"referralIdError\"] = \"No referral ID found in the input\";\n    }\n} else {\n    log[\"error\"] = \"Input does not match /start ref pattern\";\n}\n\n// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ ÙˆØ±ÙˆØ¯ÛŒ ØºÛŒØ±Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯\nconst userErrorMessage = {\n    url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n    method: \"POST\",\n    parameters: {\n        chat_id: userData[\"id\"],\n        text: \"Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù… Ú†ÛŒ Ú¯ÙØªÛŒ! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯. ğŸ¤”\",\n        parse_mode: \"HTML\"\n    }\n};\n\nlog[\"userErrorMessage\"] = userErrorMessage;  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ù„Ø§Ú¯\n\nreturn {\n    json: {\n        userError: userErrorMessage,\n        log: log // Ù„Ø§Ú¯ Ø±Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        860,
        700
      ],
      "id": "4f243b08-0a62-4e50-96f6-05d811669adf",
      "name": "Make Menu Message5"
    },
    {
      "parameters": {
        "method": "={{ $json.userMessage.method }}",
        "url": "={{ $json.userMessage.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.userMessage.parameters }}",
        "options": {}
      },
      "id": "814a28fe-44eb-4b66-8726-b980c84fd51a",
      "name": "Send To User",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1040,
        700
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message5').item.json.referrerMessage.method }}",
        "url": "={{ $('Make Menu Message5').item.json.referrerMessage.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message5').item.json.referrerMessage.parameters }}",
        "options": {}
      },
      "id": "0fe05e7f-87e6-41ae-82b3-4788d6ae8aca",
      "name": "Send To Referrer",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1240,
        700
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message5').item.json.adminMessage.method }}",
        "url": "={{ $('Make Menu Message5').item.json.adminMessage.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message5').item.json.adminMessage.parameters }}",
        "options": {}
      },
      "id": "25b1a48f-c04f-41c1-887a-6b7981c22450",
      "name": "Send To Admin",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1420,
        700
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT CASE \n    WHEN EXISTS (SELECT 1 FROM users WHERE user_id = {{ $('If').item.json.result.user.id }}) THEN true\n    ELSE false\nEND AS user_exists;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        640,
        700
      ],
      "id": "15ba7e00-d490-4646-9e6b-c8d37d8d6637",
      "name": "Check User Existence",
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡\nINSERT INTO users (user_id, phone_number, balance, username, created_at)\nVALUES ({{ $('Send To User').item.json.result.chat.id }}, '', {{ $('BOT INFO').item.json[\"referal-creadit\"] }}, '{{ $('Send To User').item.json.result.chat.username || '' }}', {{ $('SIMORGH').item.json.message.date }})\nON DUPLICATE KEY UPDATE \n    balance = balance + {{ $('BOT INFO').item.json[\"referal-creadit\"] }};  \n\n-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\nINSERT INTO users (user_id, phone_number, balance, username, created_at)\nVALUES ({{ $('Send To Referrer').item.json.result.chat.id }}, '', {{ $('BOT INFO').item.json[\"referal-creadit\"] }}, '{{ $('Send To Referrer').item.json.result.chat.username || '' }}', {{ $('SIMORGH').item.json.message.date }})\nON DUPLICATE KEY UPDATE \n    balance = balance + {{ $('BOT INFO').item.json[\"referal-creadit\"] }};  \n\n-- Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø¬Ø¯ÙˆÙ„ referrals\nINSERT INTO referrals (inviter_user_id, invitee_user_id, inviter_cart_amount, invitee_cart_amount, referral_date)\nVALUES \n(\n    {{ $('Send To Referrer').item.json.result.chat.id }},  -- Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\n    {{ $('Send To User').item.json.result.chat.id }},     -- Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡\n    {{ $('BOT INFO').item.json[\"referal-creadit\"] }},      -- Ù…Ø¨Ù„Øº Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\n    {{ $('BOT INFO').item.json[\"referal-creadit\"] }},      -- Ù…Ø¨Ù„Øº Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡\n    CURRENT_TIMESTAMP                                      -- ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø§Ø±Ø¬Ø§Ø¹\n)",
        "options": {}
      },
      "id": "6c9b1168-ccb2-4843-8319-6975140e663d",
      "name": "Set User AND UPDATE balance",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1620,
        700
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ú¯Ø±ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² Ù†ÙˆØ¯ BOT TOKEN\nconst botData = $('BOT INFO').item.json; // Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ BOT TOKEN\nconst botName = botData[\"bot-name\"] || \"Ù†Ø§Ù… Ø¨Ø§Øª ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø¨Ø§Øª\nconst botsupport = botData[\"support-username\"] || \"Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ\nconst botadmin = botData[\"admin-username\"] || \"Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø§Ø¯Ù…ÛŒÙ†\nconst bottoken = botData[\"TOKEN\"] || \"ØªÙˆÚ©Ù† Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ø¨Ø§Øª\nconst botcreator = botData[\"bot-creator\"] || \"Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†Ø¯Ø§Ø±Ø¯\"; // Ø¯Ø±ÛŒØ§ÙØª Ù†Ø§Ù… Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ø§Øª\nconst botreferalcreadit = parseInt(botData[\"referal-creadit\"] || \"0\", 10); // Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¹ØªØ¨Ø§Ø± Ø±ÙØ±Ø§Ù„ Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø¹Ø¯Ø¯\n\n// Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± original Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst inputData = $('Merge Switcher data').item.json.original; // ÙˆØ±ÙˆØ¯ÛŒ Ø§ØµÙ„ÛŒ Ø§Ø² Ù†ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ\nconst userData = $('Coffe-Mahdi').item.json.callback_query.from; // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø² Ù†ÙˆØ¯ User Info Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯\nconst MessageData = $('Coffe-Mahdi').item.json.callback_query.message;\n\n// Ù†ÙˆØ¯ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø¨Ø±\nconst userExists = $('Check User Existence1').item.json.user_exists; // Ø®Ø±ÙˆØ¬ÛŒ Ù†ÙˆØ¯ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÙˆØ¬ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø¨Ø±\n\n// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øªâ€ŒØ¨Ù†Ø¯ÛŒ Ù…Ø¨Ù„Øº Ø±ÙØ±Ø§Ù„ Ø¨Ù‡ Ø³Ù‡ Ø±Ù‚Ù… Ø³Ù‡ Ø±Ù‚Ù…\nfunction formatNumberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\n// Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ\nlet log = {\n    inputData: inputData,\n};\n\n// Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ±ÙˆØ¯ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ø¨ÛŒÙ‡ Ø¨Ù‡ \"joinedch^1983438871\"\nif (inputData && inputData.startsWith(\"joinedch^\")) {\n    const refCodeMatch = inputData.match(/joinedch\\^(\\d+)/);  // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² regex Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÛŒÙˆØ²Ø± Ø¢ÛŒØ¯ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\n    if (refCodeMatch) {\n        const referrerId = refCodeMatch[1];  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÛŒÙˆØ²Ø± Ø¢ÛŒØ¯ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\n\n        // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø®ÙˆØ¯Ø´ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ÛŒØ§ Ù†Ù‡\n        if (String(userData[\"id\"]) === String(referrerId)) {\n            const selfReferralMessage = \"Ø´Ù…Ø§ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø®ÙˆØ¯ØªØ§Ù† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø¹ÙˆØª Ú©Ù†ÛŒØ¯.\";\n\n            const result = {\n                json: {}\n            };\n            result.json = {\n                url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                method: \"POST\",\n                parameters: {\n                    chat_id: userData[\"id\"],\n                    text: selfReferralMessage,\n                    message_id: MessageData[\"message_id\"],\n                    parse_mode: \"HTML\",\n                    reply_markup: {\n                        inline_keyboard: [[{ text: \"Ø¯Ø¹ÙˆØª Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù†\", callback_data: \"Invitefriends^\" }]]\n                    }\n                }\n            };\n\n            return [{\n                result: \"self_referral\",\n                userMessage: result.json,\n                log: log\n            }];\n        }\n\n        // Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø¯ÛŒÚ¯Ø±\n        let referralMessage = \"\";\n        let referrerMessage = null;\n        let adminMessage = \"\";\n\n        if (userExists === 1) {\n            referralMessage = \"Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¹Ø¶Ùˆ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯. ğŸ˜‰\";\n            referrerMessage = null; // Ø¨Ø±Ø§ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯\n            adminMessage = \"\"; // Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯\n        } else {\n            // Ù…Ù†Ø·Ù‚ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ú©Ù‡ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø¯ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø³Øª\n            const totalReferralAmount = botreferalcreadit * 2; // Ø¬Ù…Ø¹ Ù…Ø¨Ù„Øº Ø±ÙØ±Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù\n            referralMessage = `ğŸ‰ Ù…Ø¨Ù„Øº ${formatNumberWithCommas(botreferalcreadit)} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! ğŸ’°`;\n            referrerMessage = `ğŸ‰ ÙØ±Ø¯ÛŒ Ø¨Ø§ Ù„ÛŒÙ†Ú© Ø´Ù…Ø§ ÙˆØ§Ø±Ø¯ Ø±Ø¨Ø§Øª Ø´Ø¯ Ùˆ Ù…Ø¨Ù„Øº ${formatNumberWithCommas(botreferalcreadit)} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯! ğŸ’°`;\n            adminMessage = `ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ | ÛŒÚ© ÛŒÙˆØ²Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø¯Ø¹ÙˆØª Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù¾ÛŒÙˆØ³Øª!\\n\\n- Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡: ${userData.first_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\"} ${userData.last_name || \"Ù†Ø§Ù…Ø´Ø®Øµ\"} (@${userData.username || \"Ù†Ø§Ù…Ø´Ø®Øµ\"})\\n- Ù…Ø¨Ù„Øº Ø±ÙØ±Ø§Ù„: ${formatNumberWithCommas(totalReferralAmount)} ØªÙˆÙ…Ø§Ù†\\n- Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡: ${referrerId}\\n- Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡: ${userData[\"id\"]}`;\n        }\n\n        const result = {\n            json: {\n                user: {\n                    url: `https://api.telegram.org/bot${bottoken}/editMessageText`,\n                    method: \"POST\",\n                    parameters: {\n                        chat_id: userData[\"id\"],\n                        message_id: MessageData[\"message_id\"],\n                        text: referralMessage,\n                        parse_mode: \"HTML\",  // Added missing comma\n                        reply_markup: {\n                            inline_keyboard: [[{ text: \"Ø¯Ø±ÛŒØ§ÙØª Ù…Ù†Ùˆ\", callback_data: \"userpanel^\" }]]\n                        }\n                    }\n                }\n            }\n        };\n\n        if (referrerMessage) {\n            result.json.referrer = {\n                url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n                method: \"POST\",\n                parameters: {\n                    chat_id: referrerId,\n                    text: referrerMessage,\n                    parse_mode: \"HTML\"\n                }\n            };\n        }\n\n        result.json.admin = {\n            url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n            method: \"POST\",\n            parameters: {\n                chat_id: botadmin,\n                text: adminMessage,\n                parse_mode: \"HTML\"\n            }\n        };\n\n        log[\"result\"] = result;  // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ\n\n        return [{\n            result: userExists === 1 ? \"user_exists\" : \"new_referral\",\n            original: inputData,\n            userMessage: result.json.user,\n            referrerMessage: referrerMessage ? result.json.referrer : null,\n            adminMessage: result.json.admin,\n            log: log\n        }];\n    } else {\n        log[\"referralIdError\"] = \"No referral ID found in the input\";\n    }\n} else {\n    log[\"error\"] = \"Input does not match joinedch^ pattern\";\n}\n\n// Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ ÙˆØ±ÙˆØ¯ÛŒ ØºÛŒØ±Ù…Ø¹ØªØ¨Ø± Ø¨Ø§Ø´Ø¯\nconst userErrorMessage = {\n    url: `https://api.telegram.org/bot${bottoken}/SendMessage`,\n    method: \"POST\",\n    parameters: {\n        chat_id: userData[\"id\"],\n        text: \"Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù… Ú†ÛŒ Ú¯ÙØªÛŒ! Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯. ğŸ¤”\",\n        parse_mode: \"HTML\"\n    }\n};\n\nlog[\"userErrorMessage\"] = userErrorMessage;  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¨Ù‡ Ù„Ø§Ú¯\n\nreturn {\n    json: {\n        userError: userErrorMessage,\n        log: log // Ù„Ø§Ú¯ Ø±Ø§ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…\n    }\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        -280
      ],
      "id": "9e1c63fe-149d-44b8-9ae5-b78b7cf66646",
      "name": "Make Menu Message6"
    },
    {
      "parameters": {
        "method": "={{ $json.userMessage.method }}",
        "url": "={{ $json.userMessage.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.userMessage.parameters }}",
        "options": {}
      },
      "id": "22411e0a-022d-4dfb-a0ed-f9310a77b567",
      "name": "Send To User1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1200,
        -280
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message6').item.json.referrerMessage.method }}",
        "url": "={{ $('Make Menu Message6').item.json.referrerMessage.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message6').item.json.referrerMessage.parameters }}",
        "options": {}
      },
      "id": "bb621eaa-0661-4d5e-a1fb-35b6fc724c3a",
      "name": "Send To Referrer1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1380,
        -280
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "method": "={{ $('Make Menu Message6').item.json.adminMessage.method }}",
        "url": "={{ $('Make Menu Message6').item.json.adminMessage.url }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $('Make Menu Message6').item.json.adminMessage.parameters }}",
        "options": {}
      },
      "id": "2898d369-07e4-4547-819b-51b0e76f6b13",
      "name": "Send To Admin1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1560,
        -280
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT CASE \n    WHEN EXISTS (SELECT 1 FROM users WHERE user_id = {{ $('If').item.json.result.user.id }}) THEN true\n    ELSE false\nEND AS user_exists;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        860,
        -280
      ],
      "id": "6be13fd7-ebb2-4a96-addc-03e3337a07fa",
      "name": "Check User Existence1",
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡\nINSERT INTO users (user_id, phone_number, balance, username, created_at)\nVALUES ({{ $('Send To User1').item.json.result.chat.id }}, '', {{ $('BOT INFO').item.json[\"referal-creadit\"] }}, '{{ $('Send To User1').item.json.result.chat.username || '' }}', {{ $('SIMORGH').item.json.callback_query.message.date }})\nON DUPLICATE KEY UPDATE \n    balance = balance + {{ $('BOT INFO').item.json[\"referal-creadit\"] }};  \n\n-- Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¨Ù„Øº Ø¨Ù‡ Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\nINSERT INTO users (user_id, phone_number, balance, username, created_at)\nVALUES ({{ $('Send To Referrer1').item.json.result.chat.id }}, '', {{ $('BOT INFO').item.json[\"referal-creadit\"] }}, '{{ $('Send To Referrer1').item.json.result.chat.username || '' }}', {{ $('SIMORGH').item.json.callback_query.message.date }})\nON DUPLICATE KEY UPDATE \n    balance = balance + {{ $('BOT INFO').item.json[\"referal-creadit\"] }};  \n\n-- Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø± Ø¬Ø¯ÙˆÙ„ referrals\nINSERT INTO referrals (inviter_user_id, invitee_user_id, inviter_cart_amount, invitee_cart_amount, referral_date)\nVALUES \n(\n    {{ $('Send To Referrer1').item.json.result.chat.id }},  -- Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\n    {{ $('Send To User1').item.json.result.chat.id }},     -- Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡\n    {{ $('BOT INFO').item.json[\"referal-creadit\"] }},      -- Ù…Ø¨Ù„Øº Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø¹ÙˆØªâ€ŒÚ©Ù†Ù†Ø¯Ù‡\n    {{ $('BOT INFO').item.json[\"referal-creadit\"] }},      -- Ù…Ø¨Ù„Øº Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø¯Ø¹ÙˆØªâ€ŒØ´ÙˆÙ†Ø¯Ù‡\n    CURRENT_TIMESTAMP                                      -- ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† Ø§Ø±Ø¬Ø§Ø¹\n)",
        "options": {}
      },
      "id": "e800f89a-0e54-4681-a901-d33690452c25",
      "name": "Set User AND UPDATE balance1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1760,
        -280
      ],
      "credentials": {
        "mySql": {
          "id": "vSbnTOv3VnJULlhr",
          "name": "Internet-coffe-Mahdi"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "*"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -780,
        20
      ],
      "id": "5238d1fa-d421-4110-be7d-9574ccac894b",
      "name": "Coffe-Mahdi",
      "webhookId": "fa3146f5-5f65-4bc1-b940-2373119f8047",
      "credentials": {
        "telegramApi": {
          "id": "yluO7J4XFRkO6HN9",
          "name": "COFFE-NET-BOT"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "orderDraft",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -800,
        1140
      ],
      "id": "cb0fa710-ddae-4093-b111-d98f827843e8",
      "name": "Webhook",
      "webhookId": "76944611-ceb9-4619-ac31-a3cf0c83b0b2"
    },
    {
      "parameters": {
        "operation": "sendDocument",
        "chatId": "=-1002478908922",
        "binaryData": true,
        "binaryPropertyName": "file",
        "additionalFields": {
          "caption": "={{ JSON.parse($('Webhook').item.json.body.orderDraft)['text-to-admin'] }}"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -580,
        1140
      ],
      "id": "26df54f5-96c8-4b20-9f18-706abcb90d6a",
      "name": "MessageTO-order.ch",
      "webhookId": "7568fc79-f650-4670-b434-4bb34f070523",
      "credentials": {
        "telegramApi": {
          "id": "yluO7J4XFRkO6HN9",
          "name": "COFFE-NET-BOT"
        }
      }
    }
  ],
  "pinData": {
    "Coffe-Mahdi": [
      {
        "json": {
          "update_id": 580300663,
          "callback_query": {
            "id": "8518805086554587589",
            "from": {
              "id": 1983438871,
              "is_bot": false,
              "first_name": "Focus ACC",
              "username": "Mena_llBOT",
              "language_code": "en"
            },
            "message": {
              "message_id": 1169,
              "from": {
                "id": 7794284252,
                "is_bot": true,
                "first_name": "Cafenet Mahdi",
                "username": "Cafenetmahdi_bot"
              },
              "chat": {
                "id": 1983438871,
                "first_name": "Focus ACC",
                "username": "Mena_llBOT",
                "type": "private"
              },
              "date": 1741752849,
              "text": "Ú©Ø§Ø±Ø¨Ø± Ú¯Ø±Ø§Ù…ÛŒ\nÙ„Ø·ÙØ§ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ú©Ø§ÙÛŒ Ù†Øª Ù…Ù‡Ø¯ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ :",
              "reply_markup": {
                "inline_keyboard": [
                  [
                    {
                      "text": "Ù„ÛŒØ³Øª Ø®Ø¯Ù…Ø§Øª Ú©Ø§ÙÛŒ Ù†Øª Ù…Ù‡Ø¯ÛŒ",
                      "callback_data": "serviceslist^"
                    }
                  ],
                  [
                    {
                      "text": "ğŸ’ Ø§Ø¹ØªØ¨Ø§Ø± Ø´Ù…Ø§",
                      "callback_data": "userprofile^"
                    },
                    {
                      "text": "ğŸ› Ø¨Ø§Ø´Ú¯Ø§Ù‡ Ù…Ø´ØªØ±ÛŒØ§Ù† ",
                      "callback_data": "club^"
                    }
                  ],
                  [
                    {
                      "text": "â£ï¸ Ø¯Ø¹ÙˆØª Ø§Ø² Ø¯ÙˆØ³ØªØ§Ù†",
                      "callback_data": "Invitefriends^"
                    }
                  ],
                  [
                    {
                      "text": "Â» Ø±Ø§Ù‡Ù†Ù…Ø§",
                      "callback_data": "help^"
                    },
                    {
                      "text": "Â» Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ",
                      "url": "https://t.me/mohamminch"
                    }
                  ]
                ]
              }
            },
            "chat_instance": "8745375940650992355",
            "data": "serviceslist^"
          }
        }
      }
    ],
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "besparbot.pelicanstudio.ir",
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
            "content-length": "380643",
            "accept": "*/*",
            "accept-encoding": "gzip, deflate, br, zstd",
            "accept-language": "en-US,en;q=0.9,fa;q=0.8,fr;q=0.7,de;q=0.6",
            "content-type": "multipart/form-data; boundary=----WebKitFormBoundaryKgguxL4Ck8v5YzgB",
            "origin": "https://pelicanstudio.ir",
            "priority": "u=1, i",
            "referer": "https://pelicanstudio.ir/",
            "sec-ch-ua": "\"Chromium\";v=\"134\", \"Not:A-Brand\";v=\"24\", \"Google Chrome\";v=\"134\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Windows\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-site",
            "x-forwarded-for": "172.30.23.1",
            "x-forwarded-host": "besparbot.pelicanstudio.ir",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-cddf9778-wlbwk",
            "x-real-ip": "172.30.23.1"
          },
          "params": {},
          "query": {},
          "body": {
            "orderDraft": "{\"orderCode\":\"M86QNZRST2JSP2SM\",\"name\":\"Ø§Ù…ÛŒØ±Ù…Ù‡Ø¯ÛŒ Ú†Ø±Ø§ØºÛŒØ§Ù†\",\"phone\":\"09199704108\",\"files\":[{\"name\":\"photo_2024-03-28_04-40-42.jpg\",\"settings\":{\"color\":\"blackWhite\",\"printType\":\"singleSided\",\"paperSize\":\"A4\",\"paperType\":\"normal\",\"copies\":1,\"pageCount\":1,\"pageRange\":\"\",\"staple\":false,\"notes\":\"\"},\"price\":4500},{\"name\":\"MaintenancePlan.pdf\",\"settings\":{\"color\":\"blackWhite\",\"printType\":\"singleSided\",\"paperSize\":\"A4\",\"paperType\":\"normal\",\"copies\":1,\"pageCount\":3,\"pageRange\":\"1-3\",\"staple\":false,\"notes\":\"\",\"totalPages\":3},\"price\":13500}],\"deliveryMethod\":\"pickup\",\"totalPrice\":18000,\"discountPercent\":0,\"user_id\":\"7534724248\",\"zipFileName\":\"7534724248_20250313.zip\",\"zipDownloadUrl\":\"https://besparbot.pelicanstudio.ir/uploads/7534724248_20250313.zip\",\"text-to-admin\":\"ğŸ”” Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯!\\n\\nğŸ“¦ Ú©Ø¯ Ø³ÙØ§Ø±Ø´: M86QNZRST2JSP2SM\\nğŸ‘¤ Ù†Ø§Ù…: Ø§Ù…ÛŒØ±Ù…Ù‡Ø¯ÛŒ Ú†Ø±Ø§ØºÛŒØ§Ù†\\nğŸ“± ØªÙ„ÙÙ†: 09199704108\\nğŸ†” Ø´Ù†Ø§Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±: 7534724248\\n\\nğŸ“„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:\\nâ€¢ photo_2024-03-28_04-40-42.jpg (1 ØµÙØ­Ù‡)\\n               Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯ | ÛŒÚ©â€ŒØ±Ùˆ | A4\\n               Ú©Ø§ØºØ° Ù…Ø¹Ù…ÙˆÙ„ÛŒ\\n               \\nâ€¢ MaintenancePlan.pdf (3 ØµÙØ­Ù‡)\\n               Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯ | ÛŒÚ©â€ŒØ±Ùˆ | A4\\n               Ú©Ø§ØºØ° Ù…Ø¹Ù…ÙˆÙ„ÛŒ\\n               \\n\\nğŸšš Ø±ÙˆØ´ ØªØ­ÙˆÛŒÙ„: ØªØ­ÙˆÛŒÙ„ Ø­Ø¶ÙˆØ±ÛŒ\\n\\nğŸ’° Ù…Ø¨Ù„Øº Ú©Ù„: Û±Û¸Ù¬Û°Û°Û° ØªÙˆÙ…Ø§Ù†\\n\\nâ³ ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª\\nâš¡ï¸ Powered by PelicanStudio.ir\",\"text-to-user\":\"Ø§Ù…ÛŒØ±Ù…Ù‡Ø¯ÛŒ Ú†Ø±Ø§ØºÛŒØ§Ù† Ø¹Ø²ÛŒØ²ØŒ\\nØ³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯! ğŸ‰\\n\\nğŸ“¦ Ú©Ø¯ Ø³ÙØ§Ø±Ø´: M86QNZRST2JSP2SM\\n\\nğŸ“„ Ù…Ø´Ø®ØµØ§Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ:\\nâ€¢ photo_2024-03-28_04-40-42.jpg\\n    - ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª: 1 ØµÙØ­Ù‡\\n    - ØªØ¹Ø¯Ø§Ø¯ Ù†Ø³Ø®Ù‡: 1\\n    - Ù†ÙˆØ¹ Ú†Ø§Ù¾: Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯\\n    - Ø±ÙˆØ´ Ú†Ø§Ù¾: ÛŒÚ©â€ŒØ±Ùˆ\\n    - Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§ØºØ°: A4\\n    - Ù†ÙˆØ¹ Ú©Ø§ØºØ°: Ù…Ø¹Ù…ÙˆÙ„ÛŒ\\n    \\n    \\n\\nâ€¢ MaintenancePlan.pdf\\n    - ØªØ¹Ø¯Ø§Ø¯ ØµÙØ­Ø§Øª: 3 ØµÙØ­Ù‡\\n    - ØªØ¹Ø¯Ø§Ø¯ Ù†Ø³Ø®Ù‡: 1\\n    - Ù†ÙˆØ¹ Ú†Ø§Ù¾: Ø³ÛŒØ§Ù‡ Ùˆ Ø³ÙÛŒØ¯\\n    - Ø±ÙˆØ´ Ú†Ø§Ù¾: ÛŒÚ©â€ŒØ±Ùˆ\\n    - Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø§ØºØ°: A4\\n    - Ù†ÙˆØ¹ Ú©Ø§ØºØ°: Ù…Ø¹Ù…ÙˆÙ„ÛŒ\\n    \\n    \\n\\nğŸšš Ø±ÙˆØ´ ØªØ­ÙˆÛŒÙ„: ØªØ­ÙˆÛŒÙ„ Ø­Ø¶ÙˆØ±ÛŒ\\n\\nğŸ’° Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª: Û±Û¸Ù¬Û°Û°Û° ØªÙˆÙ…Ø§Ù†\\n\\n\\nâš ï¸ ØªÙˆØ¬Ù‡: Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ø³Øª.\\nÙ„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´ØŒ Ù…Ø¨Ù„Øº Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù„ÛŒÙ†Ú© Ù¾Ø±Ø¯Ø§Ø®Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ù…Ø§ÛŒÛŒØ¯.\\n\\nØ¨Ø§ ØªØ´Ú©Ø± Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø§ ğŸ™\\nÚ©Ø§ÙÛŒâ€ŒÙ†Øª Ù…Ù‡Ø¯ÛŒ\"}"
          },
          "webhookUrl": "https://besparbot.pelicanstudio.ir/webhook/orderDraft",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "Switch": {
      "main": [
        [
          {
            "node": "Make Menu Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Make query",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check User Existence1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BOT INFO": {
      "main": [
        [
          {
            "node": "Check Channel User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Switcher data": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Switcher text": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Make Menu Message3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check User Existence",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Make Menu Message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check user_exists": {
      "main": [
        [
          {
            "node": "T OR F",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set User": {
      "main": [
        [
          {
            "node": "New User Notify Admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T OR F": {
      "main": [
        [
          {
            "node": "Set User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make query": {
      "main": [
        [
          {
            "node": "Request-to-db",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Request-to-db": {
      "main": [
        [
          {
            "node": "Make Menu Message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message2": {
      "main": [
        [
          {
            "node": "SEND result Click Menu Layer 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Channel User": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Check Creator",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check_Message_type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Creator": {
      "main": [
        [
          {
            "node": "LINK JOIN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check_Message_type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check_Message_type": {
      "main": [
        [
          {
            "node": "Merge Switcher data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge Switcher text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check user_exists1": {
      "main": [
        [
          {
            "node": "T OR F1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T OR F1": {
      "main": [
        [
          {
            "node": "Set User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set User1": {
      "main": [
        [
          {
            "node": "New User Notify Admin1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu Layer 1": {
      "main": [
        [
          {
            "node": "Check user_exists1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message3": {
      "main": [
        [
          {
            "node": "SEND result Click Menu TO USER",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu TO USER": {
      "main": [
        [
          {
            "node": "SEND result Click Menu TO ADMIN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu TO ADMIN": {
      "main": [
        [
          {
            "node": "Check user_exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SEND result Click Menu TO USER1": {
      "main": [
        [
          {
            "node": "SEND result Click Menu TO ADMIN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message4": {
      "main": [
        [
          {
            "node": "SEND result Click Menu TO USER1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message5": {
      "main": [
        [
          {
            "node": "Send To User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To User": {
      "main": [
        [
          {
            "node": "Send To Referrer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To Referrer": {
      "main": [
        [
          {
            "node": "Send To Admin",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check User Existence": {
      "main": [
        [
          {
            "node": "Make Menu Message5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To Admin": {
      "main": [
        [
          {
            "node": "Set User AND UPDATE balance",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Menu Message6": {
      "main": [
        [
          {
            "node": "Send To User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To User1": {
      "main": [
        [
          {
            "node": "Send To Referrer1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To Referrer1": {
      "main": [
        [
          {
            "node": "Send To Admin1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send To Admin1": {
      "main": [
        [
          {
            "node": "Set User AND UPDATE balance1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check User Existence1": {
      "main": [
        [
          {
            "node": "Make Menu Message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Coffe-Mahdi": {
      "main": [
        [
          {
            "node": "BOT INFO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "MessageTO-order.ch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "82077602-a2db-4577-bd58-da3281be50b9",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "ae97ba35770b76a9a65a530931f4cf26a9e56cda380a49b095c8aa5a31c5bd2a"
  },
  "id": "s64GKt0xMc0e01Z7",
  "tags": []
}